{% extends "layout.html" %}

{% block content %}
<header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <div>
        <h1>Designs</h1>
        <p class="text-muted">Manage experiment design files (CSVs)</p>
    </div>
    <form action="{{ url_for('create_design') }}" method="POST" style="display: flex; gap: 0.5rem;">
        <input type="text" name="filename" placeholder="New design name..." required style="width: 200px;">
        <button type="submit" class="btn btn-primary">
            <i class="fa-solid fa-plus"></i> Create
        </button>
    </form>
</header>

<div class="card">
    <h2>Available Designs</h2>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
        <div
            style="background: var(--bg-dark); padding: 1.5rem; border-radius: var(--radius); border: 1px solid var(--border);">
            <h3 style="margin-top: 0; font-size: 1.1rem; margin-bottom: 1rem;"><i
                    class="fa-solid fa-magnifying-glass"></i> Scan for Designs</h3>
            <form action="{{ url_for('scan_designs') }}" method="POST"
                style="display: flex; gap: 0.5rem; flex-direction: column;">
                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" name="scan_path" id="scanPathInput" class="form-control"
                        placeholder="/path/to/project_folder" value="{{ scan_path if scan_path else '' }}" required>
                    <button type="button" class="btn btn-outline" onclick="openBrowserModal('scanPathInput')">
                        <i class="fa-solid fa-folder-open"></i>
                    </button>
                </div>

                <div style="display: flex; gap: 0.5rem;">
                    <button type="submit" class="btn btn-outline" style="flex-grow: 1;">Scan</button>
                    {% if scan_mode %}
                    <a href="{{ url_for('designs_list') }}" class="btn btn-outline"
                        style="color: var(--text-muted);">Clear</a>
                    {% endif %}
                </div>
            </form>
        </div>

        <div
            style="background: var(--bg-dark); padding: 1.5rem; border-radius: var(--radius); border: 1px solid var(--border);">
            <h3 style="margin-top: 0; font-size: 1.1rem; margin-bottom: 1rem;"><i
                    class="fa-solid fa-wand-magic-sparkles"></i> Generate from FASTQs</h3>
            <form action="{{ url_for('generate_design') }}" method="POST"
                style="display: flex; flex-direction: column; gap: 0.5rem;">
                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" name="folder_path" id="folderPathInput" class="form-control"
                        placeholder="Folder with FASTQs (e.g. /data/fastqs)" required>
                    <button type="button" class="btn btn-outline" onclick="openBrowserModal('folderPathInput')">
                        <i class="fa-solid fa-folder-open"></i>
                    </button>
                </div>

                <div style="display: flex; gap: 0.5rem;">
                    <select name="assay" class="form-control" required style="flex-grow: 1;">
                        <option value="" disabled selected>Select Assay...</option>
                        {% for assay in assays %}
                        <option value="{{ assay }}">{{ assay }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" name="output_dir" id="outputDirInput" class="form-control"
                        placeholder="Output Dir (optional, defaults to designs/)" style="flex-grow: 1;">
                    <button type="button" class="btn btn-outline" onclick="openBrowserModal('outputDirInput')">
                        <i class="fa-solid fa-folder-open"></i>
                    </button>
                </div>

                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" name="output_name" class="form-control"
                        placeholder="Output Name (e.g. design.csv)" required style="flex-grow: 1;">
                </div>
                <button type="submit" class="btn btn-primary">Generate & Edit</button>
            </form>
        </div>
    </div>

    {% if designs %}
    <div class="list-group">
        {% for design in designs %}
        <div class="list-item">
            <div class="item-content">
                <div class="item-title">
                    {% if scan_mode %}
                    {{ design.rel_path }} <span class="text-muted" style="font-size: 0.8rem;">({{ design.path }})</span>
                    {% else %}
                    {{ design.name }}
                    {% endif %}
                </div>
            </div>
            <div class="item-actions">
                <a href="{{ url_for('edit_design', filename=design.path) }}" class="btn btn-outline btn-sm">Edit</a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="text-muted">No design files found.</p>
    {% endif %}
</div>

{% endblock %}