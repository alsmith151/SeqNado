BootStrap: docker
From: mambaorg/micromamba:alpine

%files
  environment_slim.yml /opt/environment_slim.yml
  
%post
  
  # # Pre set up
  cd /opt/
  apk --no-cache add curl gcc git cmake make libtool g++ pkgconfig perl openssl-dev linux-headers


  # Mamba packages
  micromamba install -y -n base -f /opt/environment_slim.yml
  export PATH="/opt/conda/bin:$PATH"

  # Rust install
  curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
  export PATH="$HOME/.cargo/bin:$PATH"

  # Install using pip
  /opt/conda/bin/python -m pip install wget git+https://github.com/alsmith151/rsbamtk.git tracknado
  

  # Clean
  apk del curl gcc git cmake make libtool g++ pkgconfig openssl-dev linux-headers
  micromamba clean -afy 
  /opt/conda/bin/python -m pip cache purge
  find /opt/conda/ -follow -type f -name '*.a' -delete
  find /opt/conda/ -follow -type f -name '*.pyc' -delete
  find /opt/conda/ -follow -type f -name '*.js.map' -delete
  ~/.cargo/bin/rustup self uninstall -y





%environment
  export PATH=/opt/conda/bin:$PATH

  