name: Unit and Integration Tests

on: 
  push

jobs:
  test-fast:
    name: Fast Tests (Unit + Integration + CLI)
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.10", "3.11", "3.12"]

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          submodules: true

      - name: Setup Conda environment and install SeqNado
        uses: conda-incubator/setup-miniconda@v3
        with:
          environment-file: testing.yml
          miniforge-version: latest
          use-mamba: true

      - name: Install SeqNado package
        shell: bash -el {0}
        run: |
          pip install .
          
          # Verify installation
          python -c "import seqnado; print(f'SeqNado installed at: {seqnado.__file__}')"
          which seqnado
          python -c "import pytest; print(f'pytest version: {pytest.__version__}')"

      - name: Run unit tests
        shell: bash -el {0}
        run: |
          pytest tests/unit/ -v --tb=short

      - name: Run integration tests
        shell: bash -el {0}
        run: |
          pytest tests/integration/ -v --tb=short

      - name: Run CLI tests
        shell: bash -el {0}
        run: |
          pytest tests/cli/ -v --tb=short
